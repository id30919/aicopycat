<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾½çƒè³½äº‹å³æ™‚çœ‹æ¿</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        h1 { text-align: center; color: #ffeb3b; margin-top: 0; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; }
        
        #grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .court-card {
            background: #333;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #444;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        
        .card-header { 
            display: flex; justify-content: space-between; align-items: center;
            font-size: 16px; color: #ccc; margin-bottom: 15px; 
            border-bottom: 1px solid #555; padding-bottom: 8px; 
        }
        .court-badge { background: #555; padding: 2px 8px; border-radius: 4px; color: white; font-weight: bold; }
        .match-info { color: #00e676; font-weight: bold; }

        .teams-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .team-box { flex: 1; text-align: center; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        
        .t-name { 
            font-size: 22px; font-weight: bold; margin-bottom: 5px; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; 
            padding: 0 5px; width: 100%;
        }
        .t-score { font-size: 60px; font-weight: bold; line-height: 1; text-shadow: 2px 2px 5px rgba(0,0,0,0.5); margin-bottom: 5px; }
        
        .t-players {
            font-size: 14px; color: #aaa; line-height: 1.4;
            background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 4px;
            max-width: 90%; word-wrap: break-word;
        }

        .color-a { color: #ff9800; } 
        .color-b { color: #00b0ff; } 
        
        .vs { font-size: 14px; color: #666; margin: 15px 10px 0; font-weight: bold; }

        .footer-info { 
            font-size: 14px; text-align: center; margin-top: 10px; 
            background: rgba(0,0,0,0.3); padding: 8px; border-radius: 5px; color: #888;
        }
        
        .server-icon { font-size: 16px; margin-left: 5px; }
        
        .no-data { text-align:center; grid-column: 1/-1; color:#666; margin-top: 50px; font-size: 18px; }
    </style>
</head>
<body>

    <h1>ğŸ¸ Live Scores</h1>
    <div id="grid-container">
        <div class="no-data">é€£ç·šä¸­... / ç­‰å¾…æ¯”è³½é–‹å§‹</div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyAq-sTArXeGDVpdjnbLEzh5WpQ5mkmsyoA",
          authDomain: "badminton-live-6237e.firebaseapp.com",
          databaseURL: "https://badminton-live-6237e-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "badminton-live-6237e",
          storageBucket: "badminton-live-6237e.firebasestorage.app",
          messagingSenderId: "414631038880",
          appId: "1:414631038880:web:acd4ad9ebcda0c4598dec5",
          measurementId: "G-2K7HYBBMXX"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const container = document.getElementById('grid-container');

            db.ref('courts').on('value', (snapshot) => {
                const data = snapshot.val();
                container.innerHTML = ""; 
                
                if (!data) {
                    container.innerHTML = "<div class='no-data'>ç›®å‰æ²’æœ‰é€²è¡Œä¸­çš„æ¯”è³½</div>";
                    return;
                }

                // V30: éæ¿¾æ‰è¶…é12å°æ™‚æœªæ›´æ–°çš„èˆŠè³‡æ–™
                const now = Date.now();
                const matches = Object.keys(data)
                    .map(key => data[key])
                    .filter(m => (now - m.timestamp) < 43200000); // 12å°æ™‚ = 43200000æ¯«ç§’

                if (matches.length === 0) {
                    container.innerHTML = "<div class='no-data'>ç›®å‰æ²’æœ‰é€²è¡Œä¸­çš„æ¯”è³½</div>";
                    return;
                }

                matches.sort((a, b) => parseInt(a.court) - parseInt(b.court));

                matches.forEach(m => {
                    const card = createCard(m);
                    container.appendChild(card);
                });
            });
        } catch(e) {
            console.error("Firebase Error", e);
            document.getElementById('grid-container').innerHTML = "<div class='no-data' style='color:red'>é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®š</div>";
        }

        function createCard(m) {
            const iconA = m.serverTeam === 'A' ? '<span class="server-icon">ğŸ¸</span>' : '';
            const iconB = m.serverTeam === 'B' ? '<span class="server-icon">ğŸ¸</span>' : '';

            const div = document.createElement('div');
            div.className = 'court-card';
            div.innerHTML = `
                <div class="card-header">
                    <span class="court-badge">å ´åœ° ${m.court}</span>
                    <span class="match-info">${m.match}</span>
                </div>
                <div class="teams-row">
                    <div class="team-box">
                        <div class="t-name color-a">${m.teamA} ${iconA}</div>
                        <div class="t-score color-a">${m.scoreA}</div>
                        <div class="t-players">${m.playersA || '-'}</div>
                    </div>
                    <div class="vs">VS</div>
                    <div class="team-box">
                        <div class="t-name color-b">${m.teamB} ${iconB}</div>
                        <div class="t-score color-b">${m.scoreB}</div>
                        <div class="t-players">${m.playersB || '-'}</div>
                    </div>
                </div>
                <div class="footer-info">
                    ä¸»å¯©: ${m.umpire || '-'}
                </div>
            `;
            return div;
        }
    </script>
</body>
</html>