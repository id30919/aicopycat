<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¸ å¤§èˆ¹ç¾½çƒå­£æ‰“è¦åŠƒèˆ‡äººæ•¸è²¡å‹™åˆ†æ ğŸ’°</title>
    <!-- å¼•å…¥ Chart.js åŠ datalabels æ’ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif; margin: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 1400px; margin: auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); }
        h1 { color: #007bff; text-align: center; border-bottom: 3px solid #007bff; padding-bottom: 10px; margin-bottom: 30px; }
        h2 { border-left: 6px solid #ffc107; padding-left: 12px; color: #333; margin-top: 30px; margin-bottom: 20px; font-size: 1.5em; }
        
        /* è¼¸å…¥å€å¡Š */
        .dynamic-inputs, .analysis-section { padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 20px; background-color: #fff; }
        
        /* å­£åº¦èˆ‡å…¨å£˜æ‰“è¼¸å…¥æ¨£å¼ */
        .input-row { display: flex; align-items: center; margin-bottom: 10px; font-size: 1.1em; font-weight: bold; }
        .period-input { width: 250px !important; text-align: left; padding: 6px; border: 1px solid #ccc; border-radius: 4px; margin-left: 10px; font-size: 1em; }
        .fullhit-input { width: 80px !important; text-align: center; padding: 6px; border: 1px solid #ccc; border-radius: 4px; margin-left: 10px; font-size: 1em; color: #000; font-weight: bold; }

        /* è¡¨æ ¼è¨­å®š - ç„¡æ ¼ç·šï¼Œå…§å®¹ç½®ä¸­ï¼Œæ¨™é¡Œä¸æ›è¡Œ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.95em; table-layout: fixed; }
        
        th { 
            background-color: #e9ecef; color: #495057; font-weight: bold; 
            padding: 12px 5px; 
            border: none; 
            white-space: nowrap; 
            overflow: hidden;
        }

        /* é‡å°ç‰¹å®šé•·æ¨™é¡Œç¸®å°å­—é«”ä»¥ç¶­æŒå–®è¡Œ */
        #result-table th:nth-child(5), /* å­£æ‰“ç¸½å ´æ¬¡ */
        #result-table th:nth-child(7), /* æ¯å ´é›¶æ‰“åƒ¹ */
        #result-table th:nth-child(9)  /* æ¯å ´å­£æ‰“åƒ¹ */
        {
            font-size: 0.85em; 
        }

        td { 
            border: none; 
            padding: 10px 5px; 
            text-align: center !important; /* å…§å®¹å¼·åˆ¶ç½®ä¸­ */
            word-wrap: break-word; 
            vertical-align: middle; 
        }
        
        /* ä¸€èˆ¬è¼¸å…¥æ¡† */
        input[type="number"], input[type="text"] { width: 90%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 1em; }
        
        /* æŒ‰éˆ• */
        .button { background-color: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; margin-top: 15px; transition: 0.2s; }
        .button:hover { background-color: #218838; }
        
        /* æ–‡å­—å€ */
        textarea { width: 100%; height: 250px; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-family: monospace; line-height: 1.4; }
        
        /* åˆ†æçµæœå€ */
        .analysis-dashboard { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
        .chart-card { flex: 1; min-width: 400px; background: #f8f9fa; border-radius: 10px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .chart-wrapper { height: 400px; position: relative; }
        
        /* ç¸½çµæ•¸æ“šå¡ç‰‡ */
        .summary-stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-box { flex: 1; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center; border: 1px solid #e9ecef; }
        .stat-title { font-size: 0.9em; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 1.4em; font-weight: bold; }
        .pos { color: #28a745; }
        .neg { color: #dc3545; }
        .neu { color: #007bff; }
        .cnt { color: #6f42c1; }

        /* AI å»ºè­°å€å¡Š */
        .ai-verdict-box { background-color: #e3f2fd; border-left: 5px solid #2196f3; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .ai-title { font-weight: bold; color: #0d47a1; margin-bottom: 5px; display: block; }

        /* çµ„åˆå„ªæƒ ç‰¹æ®Šæ¨£å¼ */
        .small-text { font-size: 0.85em; } /* ç¸®å°é•·æ–‡å­— */
        .combo-name { text-align: left !important; padding-left: 15px !important; font-weight: bold; }
        .combo-val { text-align: center !important; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¸ å¤§èˆ¹ç¾½çƒå­£æ‰“è¦åŠƒèˆ‡äººæ•¸è²¡å‹™åˆ†æ ğŸ’°</h1>

    <!-- 1. å­£æ‰“è¨ˆç•«è¼¸å…¥ -->
    <div class="dynamic-inputs">
        <h2>ğŸ—“ï¸ å­£åº¦å­£æ‰“è¨ˆç•«</h2>
        <div class="input-row">
            å­£åº¦åç¨±/æœŸé–“ï¼š<input type="text" id="period-input" value="2026 ç¬¬ä¸€å­£ (1-3æœˆ)" class="period-input">
        </div>
        
        <table id="input-table">
            <thead>
                <tr>
                    <th style="width: 5%;">é€±æ¬¡</th>
                    <th style="width: 12%;">æ‰“çƒæ™‚é–“</th>
                    <th style="width: 7%;">å ´åœ°</th>
                    <th style="width: 7%;">å ´æ¬¡</th>
                    <th style="width: 15%;">ä¸é–‹åœ˜æ—¥æœŸ</th>
                    <th style="width: 8%;">é›¶æ‰“è²»</th>
                    <th style="width: 8%;">å­£æ‰“è²»</th>
                    <th style="width: 10%;">å‚™è¨»</th>
                </tr>
            </thead>
            <tbody id="input-body">
                <tr data-key="mon"><td>é€±ä¸€</td><td>20:30-22:30</td><td>åœ‹å°</td><td><input type="number" id="mon_total" value="12"></td><td><input type="text" id="mon_off" value="10/6 ä¸­ç§‹ç¯€"></td><td><input type="number" id="mon_drop" value="250"></td><td><input type="number" id="mon_sea" value="210"></td><td><input type="text" value="è«‹å‡ä¸é€€è²»"></td></tr>
                <tr data-key="tue2"><td>é€±äºŒ (2h)</td><td>20:30-22:30</td><td>æ¿æ©‹</td><td><input type="number" id="tue2_total" value="13"></td><td><input type="text" id="tue2_off" value=""></td><td><input type="number" id="tue2_drop" value="250"></td><td><input type="number" id="tue2_sea" value="210"></td><td><input type="text" value="è«‹å‡å¯è£œä½"></td></tr>
                <tr data-key="tue3"><td>é€±äºŒ (3h)</td><td>20:30-23:30</td><td>æ¿æ©‹</td><td><input type="number" id="tue3_total" value="13"></td><td><input type="text" id="tue3_off" value=""></td><td><input type="number" id="tue3_drop" value="370"></td><td><input type="number" id="tue3_sea" value="310"></td><td><input type="text" value="è«‹å‡å¯è£œä½"></td></tr>
                <tr data-key="thu"><td>é€±å››</td><td>20:30-23:30</td><td>æ¿æ©‹</td><td><input type="number" id="thu_total" value="12"></td><td><input type="text" id="thu_off" value="12/25 è€¶èª•ç¯€"></td><td><input type="number" id="thu_drop" value="370"></td><td><input type="number" id="thu_sea" value="310"></td><td><input type="text" value="è«‹å‡ä¸é€€è²»"></td></tr>
            </tbody>
        </table>
        
        <div class="input-row">
            å…¨å£˜æ‰“å„ªæƒ ï¼š<input type="number" id="fullhit-discount" value="870" class="fullhit-input">
        </div>
        
        <button class="button" onclick="generateTable()">ğŸ“ ç”Ÿæˆè¡¨æ ¼</button>
    </div>

    <!-- 2. è¡¨æ ¼è¼¸å‡ºå€ -->
    <div id="output-area" style="display:none;">
        <h2 id="table-title">ğŸ“Š å­£æ‰“è²»ç”¨åŠå„ªæƒ æ–¹æ¡ˆ</h2>
        <table id="result-table">
            <thead>
                <tr>
                    <th style="width: 4%;">#</th>
                    <th style="width: 8%;">é€±æ¬¡/æ™‚æ®µ</th>
                    <th style="width: 9%;">æ‰“çƒæ™‚é–“</th>
                    <th style="width: 5%;">æ™‚æ•¸</th>
                    <th style="width: 5%;">å­£æ‰“<br>ç¸½å ´æ¬¡</th>
                    <th style="width: 10%;">ä¸é–‹åœ˜æ—¥æœŸ</th>
                    <th style="width: 6%;">æ¯å ´<br>é›¶æ‰“åƒ¹</th>
                    <th style="width: 7%;">é›¶æ‰“åŸåƒ¹</th>
                    <th style="width: 7%;">æ¯å ´<br>å­£æ‰“åƒ¹</th>
                    <th style="width: 7%;">å­£æ‰“å„ªæƒ </th>
                    <th style="width: 5%;">æŠ˜æ•¸</th>
                    <th style="width: 8%;">å‚™è¨»</th>
                </tr>
            </thead>
            <tbody id="result-body"></tbody>
            <tfoot id="result-foot"></tfoot>
        </table>
    </div>

    <!-- 3. æ”¶æ”¯åˆ†æè¼¸å…¥ -->
    <div class="analysis-section">
        <h2>ğŸ“‘ å­£åº¦æ”¶æ”¯èˆ‡é›¶æ‰“äººæ•¸åˆ†æ</h2>
        <p>è«‹è²¼ä¸Šæ”¶æ”¯æ˜ç´° (æ ¼å¼ï¼šæ—¥æœŸ é‡‘é¡ å‚™è¨»)ï¼š</p>
        <textarea id="expense-data" placeholder="ç¯„ä¾‹ï¼š&#10;8æœˆ31æ—¥	-36000	åœ‹èªå¯¦å°å ´åœ°è²»ç”¨&#10;10æœˆ7æ—¥	11100	é€±äºŒ3å°æ™‚é›¶æ‰“ï¼ˆ30äººï¼‰"></textarea>
        <button class="button" onclick="analyzeData()">ğŸš€ åŸ·è¡Œæ”¶æ”¯åˆ†æèˆ‡é ä¼°</button>
    </div>

    <!-- 4. åˆ†æåœ–è¡¨å€ -->
    <div id="analysis-dashboard" style="display:none;">
        <div class="summary-stats">
            <div class="stat-box"><div class="stat-title">ç¸½æ”¶å…¥</div><div id="val-inc" class="stat-value neu">0</div></div>
            <div class="stat-box"><div class="stat-title">ç¸½æ”¯å‡º</div><div id="val-exp" class="stat-value neg">0</div></div>
            <div class="stat-box"><div class="stat-title">ç¸½çµé¤˜</div><div id="val-net" class="stat-value">0</div></div>
            <div class="stat-box"><div class="stat-title">ç¸½é›¶æ‰“äººæ•¸</div><div id="val-hc" class="stat-value cnt">0</div></div>
        </div>

        <div class="ai-verdict-box">
            <span class="ai-title">ğŸ¤– AI ç‡Ÿé‹å»ºè­°èˆ‡ç¸½çµï¼š</span>
            <span id="ai-verdict-text">ç­‰å¾…åˆ†ææ•¸æ“š...</span>
        </div>

        <div class="analysis-dashboard">
            <!-- åœ“é¤…åœ–ï¼šæ”¯å‡º -->
            <div class="chart-card">
                <h4>ğŸ’¸ æ ¸å¿ƒæ”¯å‡ºä½”æ¯”</h4>
                <div class="chart-wrapper">
                    <canvas id="chart-expense"></canvas>
                </div>
            </div>
            <!-- åœ“é¤…åœ–ï¼šæ”¶å…¥ -->
            <div class="chart-card">
                <h4>ğŸ’° æ”¶å…¥ä¾†æºä½”æ¯”</h4>
                <div class="chart-wrapper">
                    <canvas id="chart-income"></canvas>
                </div>
            </div>
            <!-- é•·æ¢åœ–ï¼šäººæ•¸åˆ†æ -->
            <div class="chart-card" style="min-width: 100%;">
                <h4>ğŸ‘¥ å„é€±æ¬¡é›¶æ‰“äººæ•¸çµ±è¨ˆ (æ™‚æ®µå †ç–Š)</h4>
                <div class="chart-wrapper">
                    <canvas id="chart-headcount"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    Chart.register(ChartDataLabels);

    // --- 1. ç”Ÿæˆè¡¨æ ¼é‚è¼¯ ---
    function generateTable() {
        const period = document.getElementById('period-input').value;
        document.getElementById('table-title').textContent = `${period} å­£æ‰“è²»ç”¨åŠå„ªæƒ æ–¹æ¡ˆ`;
        
        const fullHitVal = parseInt(document.getElementById('fullhit-discount').value) || 0;
        const tbody = document.getElementById('result-body');
        const tfoot = document.getElementById('result-foot');
        tbody.innerHTML = '';
        tfoot.innerHTML = '';

        // å®šç¾©é€±æ¬¡èˆ‡åº•è‰²
        const inputs = [
            { id: 'mon', name: 'é€±ä¸€', time: '20:30-22:30', hrs: '2å°æ™‚', color: '#e4dfec' }, 
            { id: 'tue2', name: 'é€±äºŒ (2h)', time: '20:30-22:30', hrs: '2å°æ™‚', color: '#eef7e6' }, 
            { id: 'tue3', name: 'é€±äºŒ (3h)', time: '20:30-23:30', hrs: '3å°æ™‚', color: '#eef7e6' },
            { id: 'thu', name: 'é€±å››', time: '20:30-23:30', hrs: '3å°æ™‚', color: '#B3E5FC' } 
        ];

        let idx = 1;
        inputs.forEach(row => {
            const total = parseInt(document.getElementById(`${row.id}_total`).value) || 0;
            const drop = parseInt(document.getElementById(`${row.id}_drop`).value) || 0;
            const seaPer = parseInt(document.getElementById(`${row.id}_sea`).value) || 0;
            const off = document.getElementById(`${row.id}_off`).value;
            const note = document.querySelector(`tr[data-key="${row.id}"] td:last-child input`).value;

            const originalTotal = total * drop;
            const seasonTotal = total * seaPer;
            const discount = originalTotal > 0 ? Math.round((seasonTotal / originalTotal) * 100) + 'æŠ˜' : '-';

            const tr = document.createElement('tr');
            tr.style.backgroundColor = row.color; 
            tr.innerHTML = `
                <td>${idx++}</td>
                <td>${row.name}</td>
                <td>${row.time}</td>
                <td>${row.hrs}</td>
                <td>${total}</td>
                <td>${off}</td>
                <td>${drop}</td>
                <td>${originalTotal.toLocaleString()}</td>
                <td>${seaPer}</td>
                <td>${seasonTotal.toLocaleString()}</td>
                <td>${discount}</td>
                <td>${note}</td>
            `;
            tbody.appendChild(tr);
        });

        // çµ„åˆå„ªæƒ å€å¡Š (åŠ å…¥ç™½è‰²åˆ†éš”åˆ—)
        const footHTML = `
            <tr style="height: 20px;">
                <td colspan="12" style="border:none; background: #fff;"></td>
            </tr>
            <tr>
                <td colspan="7" style="background:transparent;"></td>
                <td colspan="3" style="background-color: #fff3cd; font-weight: bold; text-align: center;">çµ„åˆå„ªæƒ </td>
                <td colspan="2" style="background-color: #fff3cd;"></td>
            </tr>
            <tr>
                <td colspan="7" style="background:transparent;"></td>
                <td colspan="3" style="background-color: #f7f3e8;" class="combo-name small-text">2 å€‹ä»»æ„çµ„åˆ</td>
                <td colspan="2" style="background-color: #f7f3e8;" class="combo-val">- 200</td>
            </tr>
            <tr>
                <td colspan="7" style="background:transparent;"></td>
                <td colspan="3" style="background-color: #f7f3e8;" class="combo-name small-text">å…¨å£˜æ‰“å„ªæƒ  (é€±ä¸€ã€é€±äºŒ 3hã€é€±å››)</td>
                <td colspan="2" style="background-color: #f7f3e8;" class="combo-val">- ${fullHitVal}</td>
            </tr>
            <tr>
                <td colspan="7" style="background:transparent;"></td>
                <td colspan="3" style="background-color: #f7f3e8;" class="combo-name small-text">åœ¨å­¸å­¸ç”Ÿå„ªæƒ  (å¯èˆ‡ä¸Šè¿°å„ªæƒ åˆä½µä½¿ç”¨)</td>
                <td colspan="2" style="background-color: #f7f3e8;" class="combo-val">- 100</td>
            </tr>
            <!-- æ–°å¢åº•éƒ¨å¤§ç©ºè¡Œåˆ†éš” -->
            <tr style="height: 40px;">
                <td colspan="12" style="border:none; background: #fff;"></td>
            </tr>
        `;
        tfoot.innerHTML = footHTML;
        document.getElementById('output-area').style.display = 'block';
    }

    // --- 2. æ”¶æ”¯èˆ‡äººæ•¸åˆ†æé‚è¼¯ ---
    let charts = {};

    function analyzeData() {
        const text = document.getElementById('expense-data').value.trim();
        const lines = text.split('\n');
        
        let income = { season: 0, mon: 0, tue: 0, thu: 0, sat: 0, other: 0 };
        let expense = { venue: 0, ball: 0, other: 0 };
        let hc = { 
            'é€±ä¸€': 0, 
            'é€±äºŒ 2h': 0, 'é€±äºŒ 3h': 0, 
            'é€±å››': 0, 
            'é€±å…­ 2h': 0, 'é€±å…­ 3h': 0, 'é€±å…­ 4h': 0 
        };
        
        lines.forEach(line => {
            const parts = line.split(/\s+/);
            if (parts.length < 2) return;
            const amtStr = parts[1].replace(/,/g, '');
            const amount = parseFloat(amtStr);
            if (isNaN(amount)) return;
            
            const desc = parts.slice(2).join(' '); 

            if (amount > 0) {
                if (desc.includes('å­£æ‰“')) income.season += amount;
                else if (desc.includes('é€±ä¸€')) income.mon += amount;
                else if (desc.includes('é€±äºŒ')) income.tue += amount;
                else if (desc.includes('é€±å››')) income.thu += amount;
                else if (desc.includes('é€±å…­')) income.sat += amount;
                else income.other += amount;

                const match = desc.match(/(\d+)äºº/);
                if (match) {
                    const count = parseInt(match[1]);
                    if (desc.includes('é€±ä¸€')) hc['é€±ä¸€'] += count;
                    else if (desc.includes('é€±å››')) hc['é€±å››'] += count;
                    else if (desc.includes('é€±äºŒ')) {
                        if (desc.includes('2å°æ™‚')) hc['é€±äºŒ 2h'] += count;
                        else hc['é€±äºŒ 3h'] += count;
                    }
                    else if (desc.includes('é€±å…­')) {
                        if (desc.includes('4å°æ™‚')) hc['é€±å…­ 4h'] += count;
                        else if (desc.includes('2å°æ™‚')) hc['é€±å…­ 2h'] += count;
                        else hc['é€±å…­ 3h'] += count;
                    }
                }
            } else {
                const absAmt = Math.abs(amount);
                if (desc.includes('å ´åœ°')) expense.venue += absAmt;
                else if (desc.includes('ç¾½æ¯›çƒ') || desc.includes('ACE') || desc.includes('å‹åˆ©') || desc.includes('çƒéŒ¢')) expense.ball += absAmt;
                else expense.other += absAmt;
            }
        });

        // è²¡å‹™çµ±è¨ˆ
        const totalInc = Object.values(income).reduce((a,b)=>a+b,0);
        const totalExp = Object.values(expense).reduce((a,b)=>a+b,0);
        const net = totalInc - totalExp;
        const totalHc = Object.values(hc).reduce((a,b)=>a+b,0);

        document.getElementById('val-inc').textContent = totalInc.toLocaleString();
        document.getElementById('val-exp').textContent = '-' + totalExp.toLocaleString();
        const netEl = document.getElementById('val-net');
        netEl.textContent = net.toLocaleString();
        netEl.className = 'stat-value ' + (net >= 0 ? 'pos' : 'neg');
        document.getElementById('val-hc').textContent = totalHc.toLocaleString() + ' äººæ¬¡';

        // AI çµèª
        let advice = "";
        if (net > 30000) {
            advice = "ğŸ‰ **æœ¬å­£ç‡Ÿé‹ç‹€æ³æ¥µä½³ï¼** ç›ˆé¤˜ç›¸ç•¶å……è£•ï¼Œå»ºè­°å¯è€ƒæ…®å›é¥‹çƒå‹ï¼ˆèˆ‰è¾¦æ¯”è³½æˆ–èšé¤ï¼‰ï¼Œæˆ–é è³¼ä¸‹ä¸€å­£ç¾½çƒä»¥é–å®šæˆæœ¬ã€‚";
        } else if (net > 0) {
            advice = "âœ… **æœ¬å­£ç‡Ÿé‹ç‹€æ³ç©©å¥ã€‚** æ”¶æ”¯å¹³è¡¡ä¸”ç•¥æœ‰ç›ˆé¤˜ï¼Œè«‹æŒçºŒç¶­æŒé›¶æ‰“äººæ•¸çš„ç©©å®šæ€§ã€‚";
        } else if (net > -20000) {
            advice = "âš ï¸ **æœ¬å­£å‡ºç¾å°å¹…è™§æã€‚** å»ºè­°æª¢è¦–é›œé …æ”¯å‡ºï¼Œä¸¦åŠ å¼·æ¨å»£ç‰¹å®šå†·é–€æ™‚æ®µçš„é›¶æ‰“å ±åã€‚";
        } else {
            advice = "ğŸš¨ **æœ¬å­£é¢è‡¨è™§æå£“åŠ›ï¼** å»ºè­°æª¢è¨å­£æ‰“/é›¶æ‰“å®šåƒ¹ç­–ç•¥ï¼Œæˆ–åš´æ ¼æ§ç®¡ç”¨çƒèˆ‡å ´åœ°ç§Ÿç”¨æ™‚æ•¸ã€‚";
        }
        document.getElementById('ai-verdict-text').innerHTML = advice;

        document.getElementById('analysis-dashboard').style.display = 'block';
        renderCharts(expense, income, hc);
    }

    function renderCharts(expense, income, hc) {
        ['chart-expense', 'chart-income', 'chart-headcount'].forEach(id => {
            if (charts[id]) { charts[id].destroy(); }
        });

        const pieOpts = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right' },
                datalabels: {
                    color: '#333', font: { weight: 'bold', size: 12 },
                    textShadowBlur: 0,
                    backgroundColor: 'rgba(255,255,255,0.7)',
                    borderRadius: 4,
                    padding: 4,
                    display: 'auto',
                    formatter: (val, ctx) => {
                        const label = ctx.chart.data.labels[ctx.dataIndex];
                        const total = ctx.dataset.data.reduce((a,b)=>a+b,0);
                        const pct = Math.round(val*100/total) + '%';
                        return `${label}\n$${val.toLocaleString()}\n${pct}`;
                    }
                }
            },
            layout: { padding: 20 }
        };

        // 1. æ”¯å‡º (æ”¹è‰²: å ´åœ°è—, çƒè²»ç¶ , é›œé …æ·ºç°)
        charts['chart-expense'] = new Chart(document.getElementById('chart-expense'), {
            type: 'pie',
            data: {
                labels: ['å ´åœ°è²»', 'çƒè²»', 'é›œé …'],
                datasets: [{ 
                    data: [expense.venue, expense.ball, expense.other], 
                    backgroundColor: ['#B3E5FC', '#E8F5E9', '#F5F5F5'], 
                    borderColor: '#ccc',
                    borderWidth: 1
                }]
            },
            options: pieOpts
        });

        // 2. æ”¶å…¥
        charts['chart-income'] = new Chart(document.getElementById('chart-income'), {
            type: 'pie',
            data: {
                labels: ['å­£æ‰“', 'é€±ä¸€', 'é€±äºŒ', 'é€±å››', 'é€±å…­', 'å…¶ä»–'],
                datasets: [{ 
                    data: [income.season, income.mon, income.tue, income.thu, income.sat, income.other], 
                    backgroundColor: ['#FFC107', '#FCE4EC', '#E8F5E9', '#B3E5FC', '#FFF3E0', '#9E9E9E'],
                    borderColor: '#ccc',
                    borderWidth: 1
                }]
            },
            options: pieOpts
        });

        // 3. äººæ•¸ (å †ç–Šé•·æ¢åœ– - ä¿®æ­£é †åº)
        charts['chart-headcount'] = new Chart(document.getElementById('chart-headcount'), {
            type: 'bar',
            data: {
                labels: ['é€±ä¸€', 'é€±äºŒ', 'é€±å››', 'é€±å…­'],
                datasets: [
                    { label: 'é€±ä¸€', data: [hc['é€±ä¸€'], 0, 0, 0], backgroundColor: '#F06292', stack: 'main' }, // ç²‰ç´…æ·±
                    { label: 'é€±å››', data: [0, 0, hc['é€±å››'], 0], backgroundColor: '#4FC3F7', stack: 'main' }, // è—æ·±
                    { label: 'é€±äºŒ 3h', data: [0, hc['é€±äºŒ 3h'], 0, 0], backgroundColor: '#66BB6A', stack: 'main' }, // ç¶ æ·±
                    { label: 'é€±å…­ 4h', data: [0, 0, 0, hc['é€±å…­ 4h']], backgroundColor: '#FF9800', stack: 'main' }, // æ©˜æ·±
                    { label: 'é€±å…­ 3h', data: [0, 0, 0, hc['é€±å…­ 3h']], backgroundColor: '#FFB74D', stack: 'main' }, // æ©˜ä¸­
                    { label: 'é€±äºŒ 2h', data: [0, hc['é€±äºŒ 2h'], 0, 0], backgroundColor: '#C8E6C9', stack: 'main' }, // ç¶ æ·º
                    { label: 'é€±å…­ 2h', data: [0, 0, 0, hc['é€±å…­ 2h']], backgroundColor: '#FFE0B2', stack: 'main' }  // æ©˜æ·º
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }, 
                    datalabels: {
                        color: '#333', font: { weight: 'bold' },
                        formatter: v => v > 0 ? v : ''
                    }
                },
                scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }
            }
        });
    }
</script>

</body>
</html>